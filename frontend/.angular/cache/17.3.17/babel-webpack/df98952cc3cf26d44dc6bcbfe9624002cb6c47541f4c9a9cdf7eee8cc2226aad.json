{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/platform-browser\";\nimport * as i3 from \"@angular/common\";\nconst _c0 = (a0, a1) => ({\n  \"bg-teal-500/20 text-teal-400 border border-teal-500 shadow-[0_0_15px_rgba(20,184,166,0.4)]\": a0,\n  \"bg-slate-700 text-white hover:bg-slate-600\": a1\n});\nconst _c1 = (a0, a1) => ({\n  \"bg-orange-500/20 text-orange-400 border border-orange-500 shadow-[0_0_15px_rgba(249,115,22,0.4)]\": a0,\n  \"bg-slate-700 text-white hover:bg-slate-600\": a1\n});\nconst _c2 = (a0, a1) => ({\n  \"border-teal-500 bg-[#0f172a] shadow-[0_0_15px_rgba(20,184,166,0.2)]\": a0,\n  \"border-slate-700 bg-[#1e293b] hover:border-slate-500\": a1\n});\nconst _c3 = (a0, a1) => ({\n  \"bg-green-500/20 text-green-400\": a0,\n  \"bg-slate-700 text-gray-400\": a1\n});\nfunction LiveMonitoringComponent_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"div\", 22);\n  }\n}\nfunction LiveMonitoringComponent_img_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"img\", 23);\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"src\", ctx_r0.liveStreamUrl, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction LiveMonitoringComponent_div_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 24);\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(1, \"svg\", 25);\n    i0.ɵɵelement(2, \"path\", 26);\n    i0.ɵɵelementEnd();\n    i0.ɵɵnamespaceHTML();\n    i0.ɵɵelementStart(3, \"p\", 27);\n    i0.ɵɵtext(4, \"CAMERA OFFLINE OR UNCONFIGURED\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction LiveMonitoringComponent_div_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 28);\n    i0.ɵɵtext(1, \" No cameras found. Please add them in RTSP Setup. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction LiveMonitoringComponent_div_30_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 29);\n    i0.ɵɵlistener(\"click\", function LiveMonitoringComponent_div_30_Template_div_click_0_listener() {\n      const cam_r3 = i0.ɵɵrestoreView(_r2).$implicit;\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.selectCamera(cam_r3));\n    });\n    i0.ɵɵelementStart(1, \"div\", 30)(2, \"h4\", 31);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"span\", 32);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"p\", 33);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const cam_r3 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(5, _c2, (ctx_r0.selectedCamera == null ? null : ctx_r0.selectedCamera.gate) === cam_r3.gate, (ctx_r0.selectedCamera == null ? null : ctx_r0.selectedCamera.gate) !== cam_r3.gate));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(cam_r3.gate);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(8, _c3, cam_r3.status === \"Live\" || cam_r3.rtsp_url === \"0\", cam_r3.status !== \"Live\" && cam_r3.rtsp_url !== \"0\"));\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", cam_r3.status === \"Live\" || cam_r3.rtsp_url === \"0\" ? \"LIVE\" : \"OFFLINE\", \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(cam_r3.rtsp_url || \"No URL Configured\");\n  }\n}\nexport let LiveMonitoringComponent = /*#__PURE__*/(() => {\n  class LiveMonitoringComponent {\n    // 3. INJECT THE SANITIZER HERE!\n    constructor(http, sanitizer) {\n      this.http = http;\n      this.sanitizer = sanitizer;\n      this.cameraNodes = [];\n      this.selectedCamera = null;\n      // 2. CHANGE TYPE TO ACCEPT SAFE URLS\n      this.liveStreamUrl = '';\n      // Track which view is currently active\n      this.currentMode = 'object';\n      // Multi-tenant Account ID\n      this.userEmail = '';\n    }\n    ngOnInit() {\n      // Securely fetch the logged-in user's email\n      this.userEmail = localStorage.getItem('userEmail') || '';\n      // Load cameras for this account\n      this.loadCameras();\n    }\n    loadCameras() {\n      if (!this.userEmail) return; // Stop if no email\n      // Fetch cameras ONLY for this specific user account!\n      this.http.get(`http://localhost:8000/api/cameras?user_email=${this.userEmail}`).subscribe({\n        next: cams => {\n          this.cameraNodes = cams;\n          const firstLive = cams.find(c => c.status === 'Live' || c.rtsp_url === '0') || cams[0];\n          if (firstLive) {\n            this.selectCamera(firstLive);\n          }\n        },\n        error: err => console.error(\"Error fetching cameras\", err)\n      });\n    }\n    selectCamera(cam) {\n      this.selectedCamera = cam;\n      this.updateStreamUrl();\n    }\n    // Toggle Function! \n    setMode(newMode) {\n      this.currentMode = newMode;\n      this.updateStreamUrl();\n    }\n    updateStreamUrl() {\n      if (this.selectedCamera && (this.selectedCamera.status === 'Live' || this.selectedCamera.rtsp_url === '0')) {\n        const t = new Date().getTime();\n        const rawUrl = `http://localhost:8000/api/video-feed/${this.selectedCamera.gate}?user_email=${this.userEmail}&mode=${this.currentMode}&t=${t}`;\n        // 4. SECURE STREAM BYPASS: Tell Angular this raw URL is 100% safe to display!\n        this.liveStreamUrl = this.sanitizer.bypassSecurityTrustResourceUrl(rawUrl);\n      } else {\n        this.liveStreamUrl = '';\n      }\n    }\n    static {\n      this.ɵfac = function LiveMonitoringComponent_Factory(t) {\n        return new (t || LiveMonitoringComponent)(i0.ɵɵdirectiveInject(i1.HttpClient), i0.ɵɵdirectiveInject(i2.DomSanitizer));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: LiveMonitoringComponent,\n        selectors: [[\"app-live-monitoring\"]],\n        decls: 31,\n        vars: 14,\n        consts: [[1, \"min-h-screen\", \"bg-[#0f172a]\", \"p-6\", \"lg:p-8\", \"font-sans\", \"text-gray-300\"], [1, \"mb-6\", \"flex\", \"flex-col\", \"md:flex-row\", \"justify-between\", \"items-start\", \"md:items-center\", \"bg-[#1e293b]\", \"p-5\", \"rounded-xl\", \"border\", \"border-slate-700/50\", \"shadow-lg\", \"gap-4\"], [1, \"text-3xl\", \"font-bold\", \"text-white\", \"tracking-wide\", \"flex\", \"items-center\"], [\"fill\", \"none\", \"stroke\", \"currentColor\", \"viewBox\", \"0 0 24 24\", 1, \"w-8\", \"h-8\", \"mr-3\", \"text-blue-500\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"stroke-width\", \"2\", \"d\", \"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z\"], [1, \"text-sm\", \"text-gray-400\", \"mt-1\", \"ml-11\"], [1, \"flex\", \"space-x-3\"], [1, \"px-5\", \"py-2\", \"rounded\", \"font-bold\", \"text-sm\", \"transition-all\", \"duration-300\", 3, \"click\", \"ngClass\"], [1, \"grid\", \"grid-cols-1\", \"lg:grid-cols-4\", \"gap-6\", \"h-[70vh]\"], [1, \"lg:col-span-3\", \"bg-black\", \"border\", \"border-slate-700/50\", \"rounded-xl\", \"overflow-hidden\", \"relative\", \"shadow-2xl\", \"flex\", \"items-center\", \"justify-center\"], [1, \"absolute\", \"top-0\", \"left-0\", \"right-0\", \"bg-gradient-to-b\", \"from-black/80\", \"to-transparent\", \"p-4\", \"z-10\", \"flex\", \"justify-between\"], [1, \"flex\", \"items-center\"], [\"class\", \"w-3 h-3 bg-red-500 rounded-full animate-pulse mr-3\", 4, \"ngIf\"], [1, \"text-xl\", \"font-bold\", \"text-white\", \"tracking-widest\"], [1, \"ml-3\", \"border\", \"border-gray-500\", \"text-gray-400\", \"text-[10px]\", \"px-2\", \"py-0.5\", \"rounded\"], [\"class\", \"w-full h-full object-contain\", \"alt\", \"Live CCTV Feed\", 3, \"src\", 4, \"ngIf\"], [\"class\", \"text-center\", 4, \"ngIf\"], [1, \"lg:col-span-1\", \"bg-[#1e293b]/50\", \"border\", \"border-slate-700/50\", \"rounded-xl\", \"p-4\", \"overflow-y-auto\"], [1, \"text-xs\", \"font-bold\", \"text-gray-400\", \"uppercase\", \"tracking-widest\", \"mb-4\"], [\"class\", \"text-sm text-gray-500 text-center mt-10\", 4, \"ngIf\"], [1, \"space-y-3\"], [\"class\", \"p-4 rounded-lg cursor-pointer transition-all border-2\", 3, \"ngClass\", \"click\", 4, \"ngFor\", \"ngForOf\"], [1, \"w-3\", \"h-3\", \"bg-red-500\", \"rounded-full\", \"animate-pulse\", \"mr-3\"], [\"alt\", \"Live CCTV Feed\", 1, \"w-full\", \"h-full\", \"object-contain\", 3, \"src\"], [1, \"text-center\"], [\"fill\", \"none\", \"stroke\", \"currentColor\", \"viewBox\", \"0 0 24 24\", 1, \"w-16\", \"h-16\", \"text-slate-600\", \"mx-auto\", \"mb-4\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"stroke-width\", \"2\", \"d\", \"M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414\"], [1, \"text-slate-500\", \"font-bold\", \"uppercase\", \"tracking-widest\"], [1, \"text-sm\", \"text-gray-500\", \"text-center\", \"mt-10\"], [1, \"p-4\", \"rounded-lg\", \"cursor-pointer\", \"transition-all\", \"border-2\", 3, \"click\", \"ngClass\"], [1, \"flex\", \"justify-between\", \"items-center\", \"mb-2\"], [1, \"font-bold\", \"text-white\"], [1, \"text-[10px]\", \"font-bold\", \"px-2\", \"py-1\", \"rounded\", 3, \"ngClass\"], [1, \"text-[10px]\", \"text-gray-500\", \"break-all\"]],\n        template: function LiveMonitoringComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\")(3, \"h1\", 2);\n            i0.ɵɵnamespaceSVG();\n            i0.ɵɵelementStart(4, \"svg\", 3);\n            i0.ɵɵelement(5, \"path\", 4);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtext(6, \" Live AI Monitoring \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵnamespaceHTML();\n            i0.ɵɵelementStart(7, \"p\", 5);\n            i0.ɵɵtext(8, \"Computer Vision based people detection & risk analysis\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(9, \"div\", 6)(10, \"button\", 7);\n            i0.ɵɵlistener(\"click\", function LiveMonitoringComponent_Template_button_click_10_listener() {\n              return ctx.setMode(\"object\");\n            });\n            i0.ɵɵtext(11, \" Object Detection \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(12, \"button\", 7);\n            i0.ɵɵlistener(\"click\", function LiveMonitoringComponent_Template_button_click_12_listener() {\n              return ctx.setMode(\"thermal\");\n            });\n            i0.ɵɵtext(13, \" Thermal Density \");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(14, \"div\", 8)(15, \"div\", 9)(16, \"div\", 10)(17, \"div\", 11);\n            i0.ɵɵtemplate(18, LiveMonitoringComponent_div_18_Template, 1, 0, \"div\", 12);\n            i0.ɵɵelementStart(19, \"h2\", 13);\n            i0.ɵɵtext(20);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(21, \"span\", 14);\n            i0.ɵɵtext(22, \"REC\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵtemplate(23, LiveMonitoringComponent_img_23_Template, 1, 1, \"img\", 15)(24, LiveMonitoringComponent_div_24_Template, 5, 0, \"div\", 16);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(25, \"div\", 17)(26, \"h3\", 18);\n            i0.ɵɵtext(27, \"CAMERA NODES\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(28, LiveMonitoringComponent_div_28_Template, 2, 0, \"div\", 19);\n            i0.ɵɵelementStart(29, \"div\", 20);\n            i0.ɵɵtemplate(30, LiveMonitoringComponent_div_30_Template, 8, 11, \"div\", 21);\n            i0.ɵɵelementEnd()()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(10);\n            i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(8, _c0, ctx.currentMode === \"object\", ctx.currentMode !== \"object\"));\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(11, _c1, ctx.currentMode === \"thermal\", ctx.currentMode !== \"thermal\"));\n            i0.ɵɵadvance(6);\n            i0.ɵɵproperty(\"ngIf\", ctx.liveStreamUrl);\n            i0.ɵɵadvance(2);\n            i0.ɵɵtextInterpolate((ctx.selectedCamera == null ? null : ctx.selectedCamera.gate) || \"NO SIGNAL\");\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngIf\", ctx.liveStreamUrl);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.liveStreamUrl);\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"ngIf\", ctx.cameraNodes.length === 0);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngForOf\", ctx.cameraNodes);\n          }\n        },\n        dependencies: [i3.NgClass, i3.NgForOf, i3.NgIf]\n      });\n    }\n  }\n  return LiveMonitoringComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}