{"ast":null,"code":"import { Chart, registerables } from 'chart.js';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nconst _c0 = [\"trendChart\"];\nfunction AnalysisReportComponent_div_49_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\")(1, \"div\", 28)(2, \"span\", 29);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"span\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"div\", 30);\n    i0.ɵɵelement(7, \"div\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const zone_r2 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(zone_r2.name);\n    i0.ɵɵadvance();\n    i0.ɵɵclassMapInterpolate1(\"font-bold \", zone_r2.textColor, \"\");\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate2(\"\", zone_r2.percent, \"% (\", zone_r2.level, \")\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵclassMapInterpolate1(\"\", zone_r2.barColor, \" h-2.5 rounded-full\");\n    i0.ɵɵstyleProp(\"width\", zone_r2.percent, \"%\");\n  }\n}\n// Register all chart components\nChart.register(...registerables);\nexport let AnalysisReportComponent = /*#__PURE__*/(() => {\n  class AnalysisReportComponent {\n    constructor(http) {\n      this.http = http;\n      this.metrics = {\n        peakDensity: '0%',\n        totalFootfall: '0',\n        incidents: 0,\n        avgDwellTime: '0 mins'\n      };\n      this.riskZones = [];\n      // --- NEW: Multi-tenant Account ID ---\n      this.userEmail = '';\n    }\n    ngOnInit() {\n      // 1. Securely fetch the logged-in user's email\n      this.userEmail = localStorage.getItem('userEmail') || '';\n      // Fetch real data when page loads!\n      this.fetchAnalytics();\n    }\n    fetchAnalytics() {\n      if (!this.userEmail) return; // Stop if no email is found\n      // 2. Fetch analytics ONLY for this specific user account!\n      this.http.get(`http://localhost:8000/api/analytics?user_email=${this.userEmail}`).subscribe({\n        next: data => {\n          this.metrics = {\n            peakDensity: data.peakDensity,\n            totalFootfall: data.totalFootfall,\n            incidents: data.incidents,\n            avgDwellTime: data.avgDwellTime\n          };\n          this.riskZones = this.formatRiskZones(data.riskZones);\n          // Wait a tiny bit for HTML to render, then draw the chart\n          setTimeout(() => {\n            this.renderChart(data.chartData.labels, data.chartData.data);\n          }, 100);\n        },\n        error: err => console.error(\"Failed to load analytics\", err)\n      });\n    }\n    // Gives the correct colors based on risk level\n    formatRiskZones(zones) {\n      return zones.map(zone => {\n        let barColor = 'bg-green-500';\n        let textColor = 'text-green-500';\n        if (zone.level === 'Critical') {\n          barColor = 'bg-red-500';\n          textColor = 'text-red-500';\n        } else if (zone.level === 'High') {\n          barColor = 'bg-orange-500';\n          textColor = 'text-orange-500';\n        } else if (zone.level === 'Moderate') {\n          barColor = 'bg-yellow-500';\n          textColor = 'text-yellow-500';\n        }\n        return {\n          ...zone,\n          barColor,\n          textColor\n        };\n      });\n    }\n    // Builds the beautiful Line Chart\n    renderChart(labels, dataPoints) {\n      if (this.chartInstance) {\n        this.chartInstance.destroy();\n      }\n      const ctx = this.trendChart.nativeElement.getContext('2d');\n      this.chartInstance = new Chart(ctx, {\n        type: 'line',\n        data: {\n          labels: labels,\n          datasets: [{\n            label: 'Daily Footfall',\n            data: dataPoints,\n            borderColor: '#14b8a6',\n            // Teal color matching your UI\n            backgroundColor: 'rgba(20, 184, 166, 0.1)',\n            borderWidth: 3,\n            tension: 0.4,\n            // Makes the line curvy and smooth!\n            fill: true,\n            pointBackgroundColor: '#0f172a',\n            pointBorderColor: '#14b8a6',\n            pointRadius: 4\n          }]\n        },\n        options: {\n          responsive: true,\n          maintainAspectRatio: false,\n          plugins: {\n            legend: {\n              display: false\n            }\n          },\n          scales: {\n            y: {\n              grid: {\n                color: 'rgba(148, 163, 184, 0.1)'\n              },\n              ticks: {\n                color: '#94a3b8'\n              }\n            },\n            x: {\n              grid: {\n                display: false\n              },\n              ticks: {\n                color: '#94a3b8'\n              }\n            }\n          }\n        }\n      });\n    }\n    // --- NEW MAGIC: REAL EXCEL/CSV EXPORT! ---\n    generateReport() {\n      // 1. Create the CSV Headers\n      let csvContent = \"data:text/csv;charset=utf-8,\";\n      csvContent += \"Security Zone,Current Risk Percentage,Threat Level\\n\";\n      // 2. Loop through the real database risk zones\n      this.riskZones.forEach(zone => {\n        csvContent += `${zone.name},${zone.percent}%,${zone.level}\\n`;\n      });\n      // 3. Add Overall Metrics\n      csvContent += `\\nOverall Peak Density,${this.metrics.peakDensity}\\n`;\n      csvContent += `Total Expected Footfall,${this.metrics.totalFootfall}\\n`;\n      csvContent += `Incidents Logged,${this.metrics.incidents}\\n`;\n      csvContent += `Avg. Dwell Time,${this.metrics.avgDwellTime}\\n`;\n      // 4. Create a hidden download link and click it!\n      const encodedUri = encodeURI(csvContent);\n      const link = document.createElement(\"a\");\n      link.setAttribute(\"href\", encodedUri);\n      link.setAttribute(\"download\", \"CrowdGuard_AI_Security_Report.csv\");\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    }\n    static {\n      this.ɵfac = function AnalysisReportComponent_Factory(t) {\n        return new (t || AnalysisReportComponent)(i0.ɵɵdirectiveInject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: AnalysisReportComponent,\n        selectors: [[\"app-analysis-report\"]],\n        viewQuery: function AnalysisReportComponent_Query(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵviewQuery(_c0, 5);\n          }\n          if (rf & 2) {\n            let _t;\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.trendChart = _t.first);\n          }\n        },\n        decls: 50,\n        vars: 5,\n        consts: [[\"trendChart\", \"\"], [1, \"min-h-screen\", \"bg-gradient-to-br\", \"from-[#0f172a]\", \"via-[#1e293b]\", \"to-[#0f172a]\", \"p-6\", \"lg:p-8\", \"font-sans\", \"text-gray-300\"], [1, \"flex\", \"justify-between\", \"items-center\", \"mb-8\"], [1, \"text-3xl\", \"font-bold\", \"text-white\", \"tracking-wide\"], [1, \"text-sm\", \"text-gray-400\", \"mt-1\"], [1, \"bg-[#14b8a6]\", \"hover:bg-[#0d9488]\", \"text-white\", \"px-5\", \"py-2.5\", \"rounded-md\", \"text-sm\", \"font-medium\", \"transition-colors\", \"shadow-lg\", \"flex\", \"items-center\", 3, \"click\"], [\"fill\", \"none\", \"stroke\", \"currentColor\", \"viewBox\", \"0 0 24 24\", 1, \"w-4\", \"h-4\", \"mr-2\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"stroke-width\", \"2\", \"d\", \"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\"], [1, \"grid\", \"grid-cols-1\", \"md:grid-cols-2\", \"lg:grid-cols-4\", \"gap-6\", \"mb-8\"], [1, \"bg-[#1e293b]/70\", \"border\", \"border-slate-700\", \"rounded-xl\", \"p-5\", \"border-t-2\", \"border-t-red-500\", \"shadow-md\"], [1, \"text-xs\", \"font-bold\", \"text-gray-400\", \"uppercase\", \"tracking-wider\"], [1, \"text-4xl\", \"font-bold\", \"text-red-500\", \"mt-2\"], [1, \"bg-[#1e293b]/70\", \"border\", \"border-slate-700\", \"rounded-xl\", \"p-5\", \"border-t-2\", \"border-t-teal-500\", \"shadow-md\"], [1, \"text-4xl\", \"font-bold\", \"text-[#2dd4bf]\", \"mt-2\"], [1, \"bg-[#1e293b]/70\", \"border\", \"border-slate-700\", \"rounded-xl\", \"p-5\", \"border-t-2\", \"border-t-orange-500\", \"shadow-md\"], [1, \"text-4xl\", \"font-bold\", \"text-orange-400\", \"mt-2\"], [1, \"bg-[#1e293b]/70\", \"border\", \"border-slate-700\", \"rounded-xl\", \"p-5\", \"border-t-2\", \"border-t-blue-500\", \"shadow-md\"], [1, \"text-4xl\", \"font-bold\", \"text-blue-400\", \"mt-2\"], [1, \"grid\", \"grid-cols-1\", \"lg:grid-cols-3\", \"gap-6\"], [1, \"lg:col-span-2\", \"bg-[#1e293b]/70\", \"border\", \"border-slate-700\", \"rounded-xl\", \"p-6\", \"shadow-md\", \"flex\", \"flex-col\"], [1, \"flex\", \"justify-between\", \"items-center\", \"mb-6\"], [1, \"text-lg\", \"font-bold\", \"text-white\"], [1, \"bg-[#0f172a]\", \"border\", \"border-slate-600\", \"rounded-md\", \"px-3\", \"py-1.5\", \"text-sm\", \"text-gray-300\", \"outline-none\", \"focus:border-blue-500\", \"cursor-pointer\"], [1, \"flex-grow\", \"min-h-[300px]\", \"relative\", \"w-full\"], [1, \"lg:col-span-1\", \"bg-[#1e293b]/70\", \"border\", \"border-slate-700\", \"rounded-xl\", \"p-6\", \"shadow-md\"], [1, \"text-lg\", \"font-bold\", \"text-white\", \"mb-8\"], [1, \"space-y-7\"], [4, \"ngFor\", \"ngForOf\"], [1, \"flex\", \"justify-between\", \"text-sm\", \"mb-2\"], [1, \"font-bold\", \"text-gray-200\"], [1, \"w-full\", \"bg-[#0f172a]\", \"rounded-full\", \"h-2.5\", \"border\", \"border-slate-700/50\"]],\n        template: function AnalysisReportComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            const _r1 = i0.ɵɵgetCurrentView();\n            i0.ɵɵelementStart(0, \"div\", 1)(1, \"div\", 2)(2, \"div\")(3, \"h1\", 3);\n            i0.ɵɵtext(4, \"Analysis & Reports\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(5, \"p\", 4);\n            i0.ɵɵtext(6, \"Historical crowd data and risk assessment\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(7, \"button\", 5);\n            i0.ɵɵlistener(\"click\", function AnalysisReportComponent_Template_button_click_7_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.generateReport());\n            });\n            i0.ɵɵnamespaceSVG();\n            i0.ɵɵelementStart(8, \"svg\", 6);\n            i0.ɵɵelement(9, \"path\", 7);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtext(10, \" Generate Custom Report \");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵnamespaceHTML();\n            i0.ɵɵelementStart(11, \"div\", 8)(12, \"div\", 9)(13, \"p\", 10);\n            i0.ɵɵtext(14, \"Peak Density (24H)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(15, \"h3\", 11);\n            i0.ɵɵtext(16);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(17, \"div\", 12)(18, \"p\", 10);\n            i0.ɵɵtext(19, \"Total Footfall (24H)\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(20, \"h3\", 13);\n            i0.ɵɵtext(21);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(22, \"div\", 14)(23, \"p\", 10);\n            i0.ɵɵtext(24, \"Incidents Logged\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(25, \"h3\", 15);\n            i0.ɵɵtext(26);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(27, \"div\", 16)(28, \"p\", 10);\n            i0.ɵɵtext(29, \"Avg. Dwell Time\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(30, \"h3\", 17);\n            i0.ɵɵtext(31);\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(32, \"div\", 18)(33, \"div\", 19)(34, \"div\", 20)(35, \"h3\", 21);\n            i0.ɵɵtext(36, \"Weekly Density Trends\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(37, \"select\", 22)(38, \"option\");\n            i0.ɵɵtext(39, \"Last 7 Days\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(40, \"option\");\n            i0.ɵɵtext(41, \"Last 30 Days\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(42, \"div\", 23);\n            i0.ɵɵelement(43, \"canvas\", null, 0);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(45, \"div\", 24)(46, \"h3\", 25);\n            i0.ɵɵtext(47, \"Risk Zone Breakdown\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(48, \"div\", 26);\n            i0.ɵɵtemplate(49, AnalysisReportComponent_div_49_Template, 8, 11, \"div\", 27);\n            i0.ɵɵelementEnd()()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(16);\n            i0.ɵɵtextInterpolate(ctx.metrics.peakDensity);\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate(ctx.metrics.totalFootfall);\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate(ctx.metrics.incidents);\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate(ctx.metrics.avgDwellTime);\n            i0.ɵɵadvance(18);\n            i0.ɵɵproperty(\"ngForOf\", ctx.riskZones);\n          }\n        },\n        dependencies: [i2.NgForOf, i3.NgSelectOption, i3.ɵNgSelectMultipleOption]\n      });\n    }\n  }\n  return AnalysisReportComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}